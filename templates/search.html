{% extends "base.html" %}
{% block body_class %}dark-theme{% endblock %}
{% block content %}
<div class="row">
    <div class="col-12">
        <h2>Results for {{ country }}</h2>
        
        {% if results %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Operator</th>
                            <th>EARFCN/ARFCN</th>
                            <th>Frequency (MHz)</th>
                            <th>Bandwidth (MHz)</th>
                            <th>Technology</th>
                            <th>MNC</th>
                            <th>MCC</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for result in results %}
                            <tr class="selectable-row"
                            data-operator="{{ result.operator_name }}"
                            data-earfcn="{{ result.earfcn_arfcn }}"
                            data-frequency="{{ result.frequency_mhz }}"
                            data-bandwidth="{{ result.bandwidth_mhz }}"
                            data-technology="{{ result.technology }}"
                            data-mnc="{{ result.mnc }}"
                            data-mcc="{{ result.mcc }}">
            
                        <td>{{ result.operator_name }}</td>
                        <td>{{ result.earfcn_arfcn }}</td>
                        <td>{{ result.frequency_mhz }}</td>
                        <td>{{ result.bandwidth_mhz }}</td>
                        <td>{{ result.technology }}</td>
                        <td>{{ result.mnc }}</td>
                        <td>{{ result.mcc }}</td>
                    </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="alert alert-info">
                No frequency bands found for this operator in this country.
            </div>
        {% endif %}
        
        <a href="{{ url_for('settings') }}" class="btn btn-secondary">Back to Settings</a>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".selectable-row").forEach(row => {
        row.addEventListener("click", () => {
            // highlight selected row
            document.querySelectorAll(".selectable-row").forEach(r => r.classList.remove("selected"));
            row.classList.add("selected");

            const data = {
                country_name:"{{country}}",
                operator_name: row.dataset.operator,
                earfcn: row.dataset.earfcn,
                frequency: row.dataset.frequency,
                bandwidth: row.dataset.bandwidth,
                technology: row.dataset.technology,
                mnc: row.dataset.mnc,
                mcc: row.dataset.mcc
            };

            // send to backend
            fetch("{{ url_for('select_operator') }}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            }).then(response => {
                if (response.ok) {
                    window.location.href = "{{ url_for('settings') }}";
                }
            });
        });
    });
});
</script>
{% endblock %}